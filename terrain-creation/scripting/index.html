<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Rigs of Rods project documentation"><meta name=author content="Rigs of Rods Community"><link href=https://rigsofrods.org/terrain-creation/scripting/ rel=canonical><link rel=icon href=../../ror-favicon.png><meta name=generator content="mkdocs-1.2.3, mkdocs-material-8.1.6"><title>Scripting - Rigs of Rods Documentation</title><link rel=stylesheet href=../../assets/stylesheets/main.cd566b2a.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.e6a45f82.min.css><meta name=theme-color content=#2094f3><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../stylesheets/ror.css><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=blue data-md-color-accent=blue> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#terrain-scripting class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Rigs of Rods Documentation" class="md-header__button md-logo" aria-label="Rigs of Rods Documentation" data-md-component=logo> <img src=../../images/branding/RoR_Logo_TT.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Rigs of Rods Documentation </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Scripting </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/RigsOfRods/docs.rigsofrods.org/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> RigsOfRods/docs.rigsofrods.org </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Rigs of Rods Documentation" class="md-nav__button md-logo" aria-label="Rigs of Rods Documentation" data-md-component=logo> <img src=../../images/branding/RoR_Logo_TT.png alt=logo> </a> Rigs of Rods Documentation </label> <div class=md-nav__source> <a href=https://github.com/RigsOfRods/docs.rigsofrods.org/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> RigsOfRods/docs.rigsofrods.org </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Gameplay <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Gameplay data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Gameplay </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../gameplay/installing-the-game/ class=md-nav__link> Installing the game </a> </li> <li class=md-nav__item> <a href=../../gameplay/beginners-guide/ class=md-nav__link> Beginner's Guide </a> </li> <li class=md-nav__item> <a href=../../gameplay/installing-content/ class=md-nav__link> Installing content (mods) </a> </li> <li class=md-nav__item> <a href=../../gameplay/controls-config/ class=md-nav__link> Controls and configuration </a> </li> <li class=md-nav__item> <a href=../../gameplay/aircraft-handling/ class=md-nav__link> Aircraft handling </a> </li> <li class=md-nav__item> <a href=../../gameplay/multiplayer-server-setup/ class=md-nav__link> Multiplayer server setup </a> </li> <li class=md-nav__item> <a href=../../gameplay/general-faq/ class=md-nav__link> General FAQ </a> </li> <li class=md-nav__item> <a href=../../gameplay/version-2020-01-faq/ class=md-nav__link> Version 2020.01 FAQ </a> </li> <li class=md-nav__item> <a href=../../gameplay/jargon/ class=md-nav__link> Jargon </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Tools and tutorials <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Tools and tutorials" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tools and tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tools-tutorials/addons/ class=md-nav__link> Installing addons </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/blender-mesh-editing/ class=md-nav__link> Blender mesh editing </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/blender-beginner/ class=md-nav__link> Blender beginner </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/editor-nodeSnap/ class=md-nav__link> Editor nodeSnap </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/visual-editors/ class=md-nav__link> Visual editors </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/contributing-github/ class=md-nav__link> How to contribute to community projects using GitHub </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Vehicle creation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Vehicle creation" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Vehicle creation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../vehicle-creation/fileformat-truck/ class=md-nav__link> Truck file format </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/fileformat-soundscript/ class=md-nav__link> Soundscript file format </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/alternate-skins/ class=md-nav__link> Alternate skins (skinzips) </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/engine/ class=md-nav__link> Engine </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/flares/ class=md-nav__link> Flares </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/flexbody-wheels/ class=md-nav__link> Flexbody wheels </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/aircraft-and-aerodynamics/ class=md-nav__link> Aircraft and aerodynamics </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/rail-vehicles/ class=md-nav__link> Rail vehicles </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/boats/ class=md-nav__link> Boats </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/motorbikes/ class=md-nav__link> Motorbikes </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/tracked-vehicles/ class=md-nav__link> Tracked vehicles </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/vehicle-concepts/ class=md-nav__link> Vehicle (Node/Beam) concepts </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/suspension/ class=md-nav__link> Suspension </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/wheels-axles-steering/ class=md-nav__link> Wheels, axles, steering </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/special-components/ class=md-nav__link> Special components </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/weight-tuning/ class=md-nav__link> Weight tuning </a> </li> <li class=md-nav__item> <a href=../../vehicle-creation/making-custom-hud/ class=md-nav__link> Making custom dashboard HUD </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5 checked> <label class=md-nav__link for=__nav_5> Terrain creation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Terrain creation" data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Terrain creation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../intro/ class=md-nav__link> Intro to terrain creation </a> </li> <li class=md-nav__item> <a href=../terrn2-subsystem/ class=md-nav__link> Terrn2 file format </a> </li> <li class=md-nav__item> <a href=../terrain-conversion-terrn2/ class=md-nav__link> Converting old terrain to terrn2 format </a> </li> <li class=md-nav__item> <a href=../editing-terrain-objects/ class=md-nav__link> Editing terrain objects </a> </li> <li class=md-nav__item> <a href=../object-format/ class=md-nav__link> Object (odef) file format </a> </li> <li class=md-nav__item> <a href=../collision-meshes/ class=md-nav__link> Collision meshes </a> </li> <li class=md-nav__item> <a href=../l3dt-map-making/ class=md-nav__link> L3DT Map Making </a> </li> <li class=md-nav__item> <a href=../shadows/ class=md-nav__link> Shadows </a> </li> <li class=md-nav__item> <a href=../building-rail-tracks/ class=md-nav__link> Building rail tracks </a> </li> <li class=md-nav__item> <a href=../race-generator/ class=md-nav__link> Race script generator </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Scripting <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Scripting </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#event-box class=md-nav__link> Event box </a> <nav class=md-nav aria-label="Event box"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#defining-the-event-box class=md-nav__link> Defining the event box </a> </li> <li class=md-nav__item> <a href=#programming-the-angelscript-file class=md-nav__link> Programming the AngelScript file </a> </li> <li class=md-nav__item> <a href=#test-run class=md-nav__link> Test-Run </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../raw-heightmaps/ class=md-nav__link> RAW Heightmaps </a> </li> <li class=md-nav__item> <a href=../custom-texture-splatting/ class=md-nav__link> Alpha splatting </a> </li> <li class=md-nav__item> <a href=../old-terrn-subsystem/ class=md-nav__link> Old (0.3x) terrain file format </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Rules <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Rules data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Rules </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../rules/terms-of-service/ class=md-nav__link> Terms of Service </a> </li> <li class=md-nav__item> <a href=../../rules/rules-unwritten/ class=md-nav__link> UNWRITTEN </a> </li> <li class=md-nav__item> <a href=../../rules/rules-stolen-content/ class=md-nav__link> STOLEN CONTENT </a> </li> <li class=md-nav__item> <a href=../../rules/rules-nice/ class=md-nav__link> NICE </a> </li> <li class=md-nav__item> <a href=../../rules/rules-backseat/ class=md-nav__link> BACKSEAT </a> </li> <li class=md-nav__item> <a href=../../rules/rules-begging/ class=md-nav__link> BEGGING </a> </li> <li class=md-nav__item> <a href=../../rules/rules-useless/ class=md-nav__link> USELESS </a> </li> <li class=md-nav__item> <a href=../../rules/rules-search/ class=md-nav__link> SEARCH </a> </li> <li class=md-nav__item> <a href=../../rules/rules-grammar/ class=md-nav__link> GRAMMAR </a> </li> <li class=md-nav__item> <a href=../../rules/rules-singularity/ class=md-nav__link> SINGULARITY </a> </li> <li class=md-nav__item> <a href=../../rules/rules-links/ class=md-nav__link> LINKS </a> </li> <li class=md-nav__item> <a href=../../legal/crash-report-privacy-policy/ class=md-nav__link> Crash Report Privacy Policy </a> </li> <li class=md-nav__item> <a href=../../tools-tutorials/branding/ class=md-nav__link> Branding </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#event-box class=md-nav__link> Event box </a> <nav class=md-nav aria-label="Event box"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#defining-the-event-box class=md-nav__link> Defining the event box </a> </li> <li class=md-nav__item> <a href=#programming-the-angelscript-file class=md-nav__link> Programming the AngelScript file </a> </li> <li class=md-nav__item> <a href=#test-run class=md-nav__link> Test-Run </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/RigsOfRods/docs.rigsofrods.org/blob/master/source/terrain-creation/scripting.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=terrain-scripting>Terrain Scripting<a class=headerlink href=#terrain-scripting title="Permanent link">&para;</a></h1> <div class="admonition warning"> <p class=admonition-title>Warning</p> <p>This page is currently NOT up-to-date with the latest version of Rigs of Rods. Script examples should still work, but links, directory locations and settings may not be accurate with the current version. </p> </div> <h2 id=event-box>Event box<a class=headerlink href=#event-box title="Permanent link">&para;</a></h2> <p>this simple example will create an oil depot that reacts on trucks that drive into it.</p> <h3 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h3> <ul> <li>move nhelens.zip to the "My Documents/Rigs of Rods/terrains" folder and unpack all its files to a new directory "nhelens"</li> <li>remove the old nhelens.zip to prevent collisions</li> <li>Enable "Debug Collision Meshes" in your RoR configurator ('Settings'&gt;'Debug'&gt;'Debug Collision Meshes') to be able to see the debug visualization for events</li> <li>get an oil-well mesh and a fitting .odef file: <a href="http://forumold.rigsofrods.com/index.php?topic=28551.msg355869#msg355869">http://forumold.rigsofrods.com/index.php?topic=28551.msg355869#msg355869</a></li> </ul> <h3 id=defining-the-event-box>Defining the event box<a class=headerlink href=#defining-the-event-box title="Permanent link">&para;</a></h3> <p>Specified using following keywords:</p> <ul> <li><strong>boxcoords</strong>: Size and position of the box, relatively to the position of the object.</li> <li><strong>virtual</strong>: specifies that this box is an event box</li> <li><strong>event</strong> [event_name] [event_type]:</li> <li><strong>event_name</strong>: the name of the box that the script will get when being notified.</li> <li><strong>event_type</strong>: valid eventTypes that trigger this: avatar, truck, airplane, delete.</li> </ul> <p>Example:</p> <pre><code>beginbox
boxcoords 0.0, 20.0, 0.0, 5.0, -4.5, -0.5
virtual
event trigger truck
endbox
</code></pre> <h3 id=programming-the-angelscript-file>Programming the AngelScript file<a class=headerlink href=#programming-the-angelscript-file title="Permanent link">&para;</a></h3> <ul> <li>create a file named <filename>.terrn.as, so in our case the file should be called "a1da0UID-nhelens.terrn.as" when the terrain we use is called "a1da0UID-nhelens.terrn"</li> </ul> <div class=highlight><pre><span></span><code>// Always include the base.as file!
#include &quot;base.as&quot;

string calledLast=&quot;&quot;;

void main()
{
    // spawn an oil-well
    game.spawnObject(&quot;oil-well&quot;, &quot;my-oil-well-1&quot;, vector3(1119.44f, 33.933f, 924.982f), vector3(0, 0, 0), &quot;myCallBack&quot;, false);
}

void myCallBack(int trigger_type, string inst, string box, int nodeid)
{
    if(calledLast == inst) return; // already triggered, discard

    // we log a message to the logfile
    log(inst + &quot; event triggered&quot;);

    // We show a message ingame
    game.flashMessage(inst + &quot; event triggered&quot;, 3, -1);

    calledLast = inst;
}
</code></pre></div> <h3 id=test-run>Test-Run<a class=headerlink href=#test-run title="Permanent link">&para;</a></h3> <p>you should see something like this:</p> <p><img alt=eventbox-debug1 src=/images/scripting-odef-eventbox-debug-1.jpg> <img alt=eventbox-debug2 src=/images/scripting-odef-eventbox-debug-2.jpg></p> <p>{: width="40%"}</p> <p>{: width="40%"}</p> <p>note: We're only interested in the pink boxes here, as they represent event boxes. Light pink boxes do not call back an AngelScript function, while dark pink boxes do call back an AngelScript function when triggered (~when you drive into them).</p> <p>if you do not see an oil loader, check the AngelScript.log file for errors. With no errors the log could read like this:</p> <p><div class=highlight><pre><span></span><code> ScriptEngine initialized
 ScriptEngine (SE) initializing ...
 Type registrations done. If you see no error above everything should be working
 ScriptEngine running
 saving script bytecode to file c:\users\jeroen\docume~1\rigs of rods 0.38\cache\script_a1da0UID-nhelens.terrn.asc
 Executing main()
 The script finished successfully.
 ```

### Result

What happens if you drive a truck into the pink event box: 

[eventbox-oilrig]: /images/scripting-odef-eventbox-oilrig.jpg
{: width=&quot;40%&quot;}

![eventbox-oilrig]

look at your AngelScript.log (on Windows, it&#39;s located under MyDocuments\Rigs of Rods 0.4\logs):

    02:55:05: SE| my-oil-well-1 event triggered

### Whats next

you could:

-   check if the correct oil tanker trailer is in the spawn box
-   direct the user to the oil unloading station after &quot;loading the oil&quot; (sleeping) for some time
-   increase the node weight of a certain node inside of the tanker trailer to simulate the loaded oil.

### Advanced Examples

for example this script will create two oil rigs and will redirect the user to collect and drop oil between them:
</code></pre></div> #include "base.as"</p> <p>float timer = 0; int timerSet = 0;</p> <p>int state = 0;</p> <p>vector3 pos_oil1(1099, 33.933, 924.982); vector3 pos_oil2(1030, 33.4509, 1125.37);</p> <p>void main() { // spawn some oil-wells game.spawnObject("oil-well", "my-oil-well-1", pos_oil1, vector3(0, 0, 0), "callBackOilWellOne", false); game.spawnObject("oil-well", "my-oil-well-2", pos_oil2, vector3(0, 0, 0), "callBackOilWellTwo", false); }</p> <p>void frameStep(float dt) { // count down the timer if(timer &gt; 0) timer -= dt; }</p> <p>void callBackOilWellOne(int trigger_type, string inst, string box, int nodeid) { //if(trigger_type != 1) return; // we only want to trigger on events where the full truck is in the event box (doesn't work at the moment) if(state != 0) return; // only process this if state is valid</p> <pre><code> if(timerSet == 0)
 {
     // set timer
     timerSet = 1;
     timer = 5;
     game.flashMessage("Loading oil ...", timer, -1);
     return;
 }

 if(timerSet == 1 &amp;&amp; timer &lt; 0)
 {
     // timer ran out, do something
     game.setDirectionArrow("unload oil", pos_oil2);
     state = 1;
     timerSet=0;
 }
</code></pre> <p>}</p> <p>void callBackOilWellTwo(int trigger_type, string inst, string box, int nodeid) { //if(trigger_type != 1) return; // we only want to trigger on events where the full truck is in the event box (doesn't work at the moment) if(state != 1) return; // only process this if state is valid</p> <pre><code> if(timerSet == 0)
 {
     // set timer
     timerSet = 1;
     timer = 5;
     game.flashMessage("Unloading oil ...", timer, -1);
     return;
 }

 if(timerSet == 1 &amp;&amp; timer &lt; 0)
 {
     // timer ran out, do something
     game.setDirectionArrow("load some new oil", pos_oil1);
     state = 0;
     timerSet=0;
 }
</code></pre> <p>} ```</p> <pre><code>In this tutorial, we will add a race to our terrain.
</code></pre> <h1 id=how-do-races-work>How do races work?<a class=headerlink href=#how-do-races-work title="Permanent link">&para;</a></h1> <p>In Rigs of Rods, races are added using a script file. The race that we will create in this tutorial will exist out of multiple checkpoints. The objective of the race is to get from the first till the last checkpoint as fast as possible.</p> <p>We will discuss 2 methods to add a race to your terrain:</p> <ol> <li>Using a race script generator (fast method);</li> <li>Manually creating the script (advanced method).</li> </ol> <h1 id=adding-a-race-fast-method>Adding a race (fast method)<a class=headerlink href=#adding-a-race-fast-method title="Permanent link">&para;</a></h1> <p>You can find a race script generator <a href=http://ror.ezzg.be/downloads/Tools/race_script_generator.html>here</a>.</p> <p>The checkpoints can be added by specifying the position (x,y,z), rotation (x,y,z) and an object for every checkpoint. This is similar to the <a href=/technical/old-terrn-subsystem>old .terrn file</a> syntax, but be aware: do NOT add the checkpoint objects to the terrain using the <a href=/technical/old-terrn-subsystem>old .terrn file</a>. The objects will already be spawned by the script.</p> <p>A checkpoint object is like every other object, but has beside a visible mesh also a virtual event box. The checkpoint will be marked as passed as soon as you drive through the virtual event box.</p> <p>If you wish, you can also use the default objects, which are available by default in every Rigs of Rods installation. To use these, use objectname "chp-start" for the start and finish line and "chp-checkpoint" for the normal checkpoints. The race script generator will use these objects if you don't specify other objects.</p> <p>After generating your race, you'll need to copy the script and put it in a new file in your terrain archive. The name of this file should be</p> <pre><code>terrainFileName.terrn.as
</code></pre> <p>. For example, for North Saint Helens, this would become:</p> <pre><code>a1da0UID-nhelens.terrn.as
</code></pre> <p>because the terrain file name of North Saint Helens is</p> <pre><code>a1da0UID-nhelens.terrn
</code></pre> <p>, and we just need to add</p> <pre><code>.as
</code></pre> <p>to that.</p> <h1 id=adding-a-race-advanced-method>Adding a race (advanced method)<a class=headerlink href=#adding-a-race-advanced-method title="Permanent link">&para;</a></h1> <p>The easiest way to explain this method is by looking at some examples.</p> <h4 id=north-saint-helens>North Saint Helens<a class=headerlink href=#north-saint-helens title="Permanent link">&para;</a></h4> <p>This example script is usable to add a race to the North Saint Helens terrain (a1da0UID-nhelens.terrn).</p> <p>Every line that starts with '//' is information that explains the line(s) beneath it.</p> <p>File: a1da0UID-nhelens.terrn.as</p> <div class=highlight><pre><span></span><code>// The following line is required in every script, in order to ensure that
// the spawnpoints keep working. It includes the script inside the file &quot;base.as&quot; here.

#include &quot;base.as&quot;

// We want to add a race, so we will need the race script.

#include &quot;races.as&quot;

// We need to initialize the race script.

racesManager races();

// Here we start the main function. 
// A function called &#39;main&#39; will get called as soon as the terrain has completed loading. 
// So inside this function is a perfect spot to tell the game about our races. 

void main() {

   // We change an option of the races script
   //    Because of the scattered nature of this race, we want to make sure that
   //    the user finds his way to the start line of the race.
   //    So, by setting this option to &#39;true&#39;, we make sure that when the user
   //    passes a checkpoint when not in a race, the user will still get a
   //    message informing the user about the race.
   races.showCheckPointInfoWhenNotInRace = true;

   // For the game to recognize the race, it needs to know where the checkpoints are,
   //    so we define them in an Array.
   //    Every line with numbers defines a checkpoint.
   //    The numbers on a line are from left to right: position X, Y, Z, rotation X, Y, Z
   //    (with position in meters and rotation in degrees)
   //    So they&#39;re coordinates to uniquely define the location and rotation of an
   //    object in a three dimensional space.
   array&lt;array&lt;double&gt;&gt; coordinates = 
       {
           // { pos X  ,  pos Y   ,   pos Z     ,  rot X  ,   rot Y   ,  rot Z  }
           {1145.762451, 43.409168,  1874.828247, 0.000000, -20.000000, 0.000000},
           {1223.362061, 66.093338,  2128.568359, 0.000000, 30.000000,  0.000000},
           {1493.947388, 90.977753,  2490.836426, 0.000000, 55.000000,  0.000000},
           {1854.234497, 141.551270, 2732.894287, 0.000000, 65.000000,  0.000000},
           {2157.161865, 130.438171, 2720.815430, 0.000000, 90.000000,  0.000000},
           {2422.710693, 110.228294, 2523.404785, 0.000000, 140.000000, 0.000000},
           {2607.359619, 107.782913, 2203.569824, 0.000000, 165.000000, 0.000000},
           {2534.100342, 107.596176, 1938.718140, 0.000000, 205.000000, 0.000000},
           {2269.411377, 134.870911, 1729.099121, 0.000000, 265.000000, 0.000000},
           {1974.688110, 104.931290, 1732.083618, 0.000000, 245.000000, 0.000000},
           {1865.982056, 101.138504, 1618.693237, 0.000000, 245.000000, 0.000000},
           {1706.379395, 148.594437, 1533.436157, 0.000000, 255.000000, 0.000000},
           {1470.152100, 120.901085, 1504.998291, 0.000000, 310.000000, 0.000000},
           // Note: No comma after the last checkpoint.
           {1238.410767, 47.336208,  1735.698242, 0.000000, 325.000000, 0.000000}
       };

   // Now we add the race with name &#39;Rigbreaker&#39;.
   // The last parameter is number of laps.
   // * This race has 1 lap.
   // * You can use &#39;races.LAPS_NoLaps&#39; to have no laps 
   //       (~the race start point is not the same checkpoint as the race finish point).
   // * You can also use &#39;races.LAPS_Unlimited&#39; to have a never ending race (~unlimited amount of laps)
   races.addRace(&quot;Rigbreaker&quot;, coordinates, 1);

} // end of the main function

// The default RoR event callback
// This procedure will get called by Rigs of Rods on certain occasions,
// decided by the race script. 
void eventCallback(int eventnum, int value) {

   // It&#39;s not obligated to add this, but it&#39;s a good habit.
   races.eventCallback(eventnum, value);

}

// end of the script. 
</code></pre></div> <h4 id=island>Island<a class=headerlink href=#island title="Permanent link">&para;</a></h4> <p>This example script is usable to add a race to the Island terrain (496aUID-island.terrn).</p> <p>File: 496aUID-island.terrn.as</p> <div class=highlight><pre><span></span><code>#include &quot;base.as&quot;
#include &quot;races.as&quot;

racesManager races();

// The default RoR main function 
void main() {

   array&lt;array&lt;double&gt;&gt; coordinates = {
       {791.551, 87.6567, 1558.25, 0.0,  35.3333, 0.0},
       {970.905, 119.2  , 1421.01, 0.0, -93.6470, 0.0},
       {1350.28, 157.644, 1375.19, 0.0, -44.4060, 0.0},
       {1506.18, 180.185, 1309.12, 0.0,  29.4644, 0.0},
       {1306.9 , 209.358, 1250.37, 0.0,  70.3679, 0.0},
       {940.346, 236.788, 926.603, 0.0,  16.9539, 0.0}
   };
   races.addRace(&quot;To The Top&quot;, coordinates, races.LAPS_NoLaps);
}

// The default RoR event callback
void eventCallback(int eventnum, int value) {

   races.eventCallback(eventnum, value);

}
</code></pre></div> <h4 id=bajarama>Bajarama<a class=headerlink href=#bajarama title="Permanent link">&para;</a></h4> <p>This example script shows a race with an unlimited amount of laps (a never ending race). It is usable with the Bajarama terrain (8c07UID-bajarama.terrn).</p> <p>File: 8c07UID-bajarama.terrn.as </p> <div class=highlight><pre><span></span><code>#include &quot;base.as&quot;
#include &quot;races.as&quot;

racesManager races();

void main() {

   array&lt;array&lt;double&gt;&gt; coords1 = {
       {179.088196,     1.351834,   203.319107,    -0.000006,    75.500044,    -0.849956},
       {56.070511,      1.247547,   119.811401,     0.000001,   109.500097,     1.700087},
       {88.742783,      2.674362,   332.812042,     0.000071,   127.500016,    -7.299959},
       {157.537796,     1.121414,   478.227203,     0.595164,   -29.497634,    -0.456070},
       {202.784286,     1.830205,   240.792023,     0.446688,   -87.490632,    -2.408985},
       {326.742004,     1.115725,   436.851685,     0.000000,     0.000003,    -0.200001},
       {360.338379,     1.100020,   102.170441,     0.000033,  -140.500010,    -0.700087},
       {482.216766,     1.089854,   430.449249,     0.000000,     0.000000,    -0.500001},
       {478.902618,     1.325789,    90.371094,     0.000000,    -0.000014,     0.000000},
       {92.562027,      1.122820,    86.679283,     0.000002,   -91.000017,     0.000002},
       {264.193359,     1.481601,   121.791405,     0.000000,  -179.999991,    -0.700000}
   };
   //                           race name coordinates   #laps          checkpoint object     startline object
   int raceID = races.addRace(&quot;Bajarama&quot;, coords1, races.LAPS_Unlimited, &quot;new-checkpoint&quot;, &quot;new-checkpoint-start&quot;);

}

// The default RoR event callback
void eventCallback(int eventnum, int value) {

   races.eventCallback(eventnum, value);

}
</code></pre></div> <h4 id=flat-map-v101>Flat Map (v10.1)<a class=headerlink href=#flat-map-v101 title="Permanent link">&para;</a></h4> <p>This example script illustrates how to add multiple races to one terrain and is usable for the Flat Map terrain (f4afUID-flat_map_full32xa.terrn).</p> <p>File: f4afUID-flat_map_full32xa.terrn.as</p> <div class=highlight><pre><span></span><code>#include &quot;base.as&quot;

#include &quot;races.as&quot;

racesManager races();

void main() {

    // We add 4 races to the map
    // RACE 1: Dirt drag race - right side
    array`&lt;array&lt;double&gt;`&gt; coords1 = {
        {2293.272705, 0.0, 2035.251465, 0.0, 0.0, 0.0},
        {2293.272705, 0.0, 1484.145752, 0.0, 0.0, 0.0}
    };
    //                              race name           coordinates   #laps
    int raceID = races.addRace(&quot;Dirt DragRace - Right Side&quot;, coords1, races.LAPS_NoLaps);
    // race 1 added and working

    // RACE 2: Dirt drag race - left side
    array`&lt;array&lt;double&gt;`&gt; coords2 = {
        {2268.944580, 0.0, 2035.251465, 0.0, 0.0, 0.0},
        {2268.944580, 0.0, 1484.145752, 0.0, 0.0, 0.0}
    };
    //                              race name           coordinates   #laps
    int raceID = races.addRace(&quot;Dirt DragRace - Left Side&quot;, coords2, races.LAPS_NoLaps);
    // race 2 added and working

    // RACE 3: Runway drag race - left side
    array`&lt;array&lt;double&gt;`&gt; coords3 = {
        {2327.494141, 1.0, 1388.388794, 0.0, 0.0, 0.0},
        {2327.494141, 1.0, 932.558044 , 0.0, 0.0, 0.0}
    };
    //                              race name           coordinates   #laps
    int raceID = races.addRace(&quot;Runway DragRace - Left Side&quot;, coords3, races.LAPS_NoLaps);
    // race 3 added and working

    // RACE 4: Runway drag race - right side
    array`&lt;array&lt;double&gt;`&gt; coords4 = {
        {2343.309814, 1.0, 1388.388794, 0.0, 0.0, 0.0},
        {2343.309814, 1.0, 932.558044 , 0.0, 0.0, 0.0}
    };
    //                              race name           coordinates   #laps
    int raceID = races.addRace(&quot;Runway DragRace - Right Side&quot;, coords4, races.LAPS_NoLaps);
    // race 4 added and working

}

// The default RoR event callback 

void eventCallback(int eventnum, int value) {

    races.eventCallback(eventnum, value);

}
</code></pre></div> <h4 id=f1-test-track>F1 Test Track<a class=headerlink href=#f1-test-track title="Permanent link">&para;</a></h4> <p>This example script illustrates how to use custom checkpoint objects and multiple races on one terrain. The script can be used with the F1 Test Track terrain (2af11UID-f1_testtrack.terrn).</p> <p>File: 2af11UID-f1_testtrack.terrn.as </p> <div class=highlight><pre><span></span><code>#include &quot;base.as&quot;

#include &quot;races.as&quot;

racesManager races();

// The default RoR main function 
void main() {

    // We add 5 races to the map

    // RACE 1
    array&lt;array&lt;double&gt;&gt; coords1 = {
            { 882.132996,    0.120613,  1324.317139,    0.0,    90.0,    0.0},
            { 658.905884,    0.076029,  1324.323730,    0.0,    90.0,    0.0},
            { 575.903259,    0.062041,  1231.623169,    0.0,     0.0,    0.0},
            { 565.184814,    0.063519,  1037.515503,    0.0,    22.0,    0.0},
            { 313.121979,    0.079952,   822.904663,    0.0,     5.0,    0.0},
            { 385.599213,    0.071390,   722.493469,    0.0,   -90.0,    0.0},
            { 770.934998,    0.012638,   761.321411,    0.0,   -90.5,    0.0},
            {1055.889404,    0.078151,   664.507324,    0.0,   -89.0,    0.0},
            {1388.452026,    0.030632,   663.976257,    0.0,    92.0,    0.0},
            {1457.364014,    0.041678,   783.509460,    0.0,   168.0,    0.0},
            {1493.774048,    0.104160,  1309.505859,    0.0,    18.5,    0.0},
            {1348.787964,    0.099335,  1324.566406,    0.0,    90.0,    0.0},
            { 909.298462,    0.044833,  1324.610596,    0.0,    88.5,    0.0}
        };
    //                              race name    coordinates   #laps         checkpoint object     startline object        finishline object
    int raceID = races.addRace(&quot;Grand Prix long&quot;, coords1, races.LAPS_NoLaps, &quot;new-checkpoint&quot;, &quot;new-checkpoint-start&quot;, &quot;new-checkpoint-start&quot;);
    // race 1 added and working

    // RACE 2
    array&lt;array&lt;double&gt;&gt; coords2 = 
        {
            {1176.429688,    0.063195,  1254.195313,    -0.0,    90.0,    0.0},
            { 693.874573,    0.090642,  1251.470825,    -0.0,    90.0,    0.0},
            { 693.383728,    0.071324,  1182.933594,    -0.0,   -90.0,    0.0},
            { 844.552612,    0.095163,  1168.225586,    -0.0,   -90.0,    0.0},
            { 941.776978,    0.052285,  1183.067139,    -0.0,   -90.0,    0.0},
            {1079.778198,    0.096842,  1183.057373,    -0.0,   -90.0,    0.0},
            {1177.627563,    0.067999,  1125.772461,    -0.0,   -40.0,    0.0},
            {1282.897095,    0.938393,  1045.571899,     0.0,   -90.0,    0.0},
            {1395.055054,    0.107390,  1148.677734,    -0.0,     0.0,    0.0},
            {1290.430908,    0.098327,  1254.477905,     0.0,    90.0,    0.0}
        };
    //                          race name    coordinates   #laps         checkpoint object     startline object        finishline object
    raceID = races.addRace(&quot;Grand Prix short&quot;, coords2, races.LAPS_NoLaps, &quot;new-checkpoint&quot;, &quot;new-checkpoint-start&quot;, &quot;new-checkpoint-start&quot;);
    // race 2 added and working

    // RACE 3
    array&lt;array&lt;double&gt;&gt; coords3 =
        {
            {1117.230103,     0.067576,   700.704956,    0.0,   -90.0,    0.0},
            {1136.480469,     0.072812,  1030.468628,    0.0,    90.0,    0.0},
            {1101.686768,     0.032589,   701.005127,    0.0,   -90.0,    0.0}
        };
    //                       race name    coordinates   #laps         checkpoint object     startline object        finishline object
    raceID = races.addRace(&quot;oval race&quot;, coords3, races.LAPS_NoLaps, &quot;new-checkpoint&quot;, &quot;new-checkpoint-start&quot;, &quot;new-checkpoint-start&quot;);
    // race 3 added and working

    // RACE 4
    array&lt;array&lt;double&gt;&gt; coords4 = 
        {
            {1187.875977,     0.0,       1220.567383,    0.0,    90.0,    0.0},
            { 784.379578,     0.0,       1221.171143,    0.0,   -90.0,    0.0}
        };
    //             race name    coordinates   #laps         checkpoint object     startline object        finishline object       race version
    raceID = races.addRace(&quot;drag race&quot;, coords4, races.LAPS_NoLaps, &quot;new-checkpoint&quot;, &quot;new-checkpoint-start&quot;, &quot;new-checkpoint-start&quot;);
    // race 4 added and working

    // RACE 5
    double[][] coords5 = 
        {
            //   x        z          y      3d rot    rot     3d rot
            { 807.868, 5.09987,   1114.47,    0.0,   -90.0,    0.0},
            { 724.386, 0.0994606, 1084.16,    0.0,     0.0,    0.0},
            { 718.647, 0.0998037, 1038.22,    0.0,    45.0,    0.0},
            { 696.235, 0.0989883,  992.215,   0.0,   -25.0,    0.0},
            { 754.302, 0.098882,   999.441,   0.0,     0.0,    0.0},
            { 763.464, 0.0987995, 1049.56,    0.0,    45.0,    0.0},
            { 831.675, 5.01375,   1058.26,    0.0,    90.0,    0.0},
            { 919.557, 0.0995347, 1083.47,    0.0,     0.0,    0.0},
            { 884.884, 0.0987005, 1121.12,    0.0,   -90.0,    0.0}
        };
    //                   race name   coordinates   #laps (no checkpoint objects are specified here, so the default RoR ones will be used)
    raceID = races.addRace(&quot;mud race&quot;, coords5, 3);
    // race 5 added and working

}

// The default RoR event callback 
void eventCallback(int eventnum, int value) {

    races.eventCallback(eventnum, value);

}
</code></pre></div> <h4 id=f1-test-track-with-penalty-events>F1 Test Track (with penalty events)<a class=headerlink href=#f1-test-track-with-penalty-events title="Permanent link">&para;</a></h4> <p>We can also penalty events if the player hits a specific part of the checkpoint.</p> <p>For this race, we've edited the 2af11UID-new-checkpoint.odef file from <a href=http://www.rigsofrods.com/repository/repo_files/view/3739>f1track_improved.zip</a> to have penalty event boxes: </p> <p><div class=highlight><pre><span></span><code>2af11UID-new-checkpoint.mesh 1, 1, 1

beginbox boxcoords -7.5, 6.95, -4.0, 5.2, -0.5, 0.5 virtual event checkpoint truck endbox

beginbox boxcoords -8.6, -7.65, 0.0, 0.55, -0.65, 0.0 virtual event race_penalty truck endbox

beginbox boxcoords 8.05, 7.1, 0.0, 0.55, -0.65, 0.0 virtual event race_penalty truck endbox

end
</code></pre></div> So the checkpoint looks like this (in debug mode): [image to be added here]</p> <p>As you can see, there are 2 small event boxes that will trigger the penalty event. The penalty event will, when triggered, add an amount of seconds to the lap time. How many seconds can be configured using the <a href=http://docs.rigsofrods.com/angelscript/classraces_manager.html#af8be93d7040eea2ae75c812fd4f99ef>races.setPenaltyTime(int raceID, int seconds)</a> method or you can just change it using the PenaltyEvent callback function.</p> <p>We'll also need this PenaltyEvent callback function when we want to show a message if a penalty event was triggered. For this we'll need to:</p> <ol> <li>Define the callback function ('on_penaltyEvent' in the script below)</li> <li>Tell the races script about this callback function ('races.setCallback("PenaltyEvent", on_penaltyEvent);')</li> </ol> <p>This is all done in the following script. Pay attention to every difference with the script above.</p> <div class=highlight><pre><span></span><code>#include &quot;base.as&quot;
#include &quot;races.as&quot;

racesManager races();

// The default RoR main function 

void main() {

    // the penalty event shows no message by default, so we&#39;ll have to show a message ourself. 
    races.setCallback(&quot;PenaltyEvent&quot;, on_penaltyEvent); 

    // We add 5 races to the map 
    // RACE 1 
    array &lt;array&lt;double&gt; &gt; coords1 = { 
            { 882.132996,    0.120613,  1324.317139,    0.0,    90.0,    0.0}, 
            { 658.905884,    0.076029,  1324.323730,    0.0,    90.0,    0.0}, 
            { 575.903259,    0.062041,  1231.623169,    0.0,     0.0,    0.0}, 
            { 565.184814,    0.063519,  1037.515503,    0.0,    22.0,    0.0}, 
            { 313.121979,    0.079952,   822.904663,    0.0,     5.0,    0.0}, 
            { 385.599213,    0.071390,   722.493469,    0.0,   -90.0,    0.0}, 
            { 770.934998,    0.012638,   761.321411,    0.0,   -90.5,    0.0}, 
            {1055.889404,    0.078151,   664.507324,    0.0,   -89.0,    0.0}, 
            {1388.452026,    0.030632,   663.976257,    0.0,    92.0,    0.0}, 
            {1457.364014,    0.041678,   783.509460,    0.0,   168.0,    0.0}, 
            {1493.774048,    0.104160,  1309.505859,    0.0,    18.5,    0.0}, 
            {1348.787964,    0.099335,  1324.566406,    0.0,    90.0,    0.0}, 
            { 909.298462,    0.044833,  1324.610596,    0.0,    88.5,    0.0} 
        }; 
    //                              race name    coordinates   #laps         checkpoint object     startline object        finishline object 
    int raceID = races.addRace(&quot;Grand Prix long&quot;, coords1, races.LAPS_NoLaps, &quot;new-checkpoint&quot;, &quot;new-checkpoint-start&quot;, &quot;new-checkpoint-start&quot;); 
    races.setPenaltyTime(raceID, 10); //  &lt;- this sets the default penalty time (in seconds) for this race when a race_penalty event occurs.
    // race 1 added and working


    // RACE 2
    array&lt;array&lt;double&gt; &gt; coords2 =  
        { 
            {1176.429688,    0.063195,  1254.195313,    -0.0,    90.0,    0.0}, 
            { 693.874573,    0.090642,  1251.470825,    -0.0,    90.0,    0.0}, 
            { 693.383728,    0.071324,  1182.933594,    -0.0,   -90.0,    0.0}, 
            { 844.552612,    0.095163,  1168.225586,    -0.0,   -90.0,    0.0}, 
            { 941.776978,    0.052285,  1183.067139,    -0.0,   -90.0,    0.0}, 
            {1079.778198,    0.096842,  1183.057373,    -0.0,   -90.0,    0.0}, 
            {1177.627563,    0.067999,  1125.772461,    -0.0,   -40.0,    0.0}, 
            {1282.897095,    0.938393,  1045.571899,     0.0,   -90.0,    0.0}, 
            {1395.055054,    0.107390,  1148.677734,    -0.0,     0.0,    0.0}, 
            {1290.430908,    0.098327,  1254.477905,     0.0,    90.0,    0.0} 
        }; 
    //                          race name    coordinates   #laps         checkpoint object     startline object        finishline object 
    raceID = races.addRace(&quot;Grand Prix short&quot;, coords2, races.LAPS_NoLaps, &quot;new-checkpoint&quot;, &quot;new-checkpoint-start&quot;, &quot;new-checkpoint-start&quot;); 
    races.setPenaltyTime(raceID, 10); //  &lt;- this sets the default penalty time (in seconds) for this race when a race_penalty event occurs.
    // race 2 added and working


    // RACE 3
    array&lt;array&lt;double&gt; &gt; coords3 =  
        { 
            {1117.230103,     0.067576,   700.704956,    0.0,   -90.0,    0.0}, 
            {1136.480469,     0.072812,  1030.468628,    0.0,    90.0,    0.0}, 
            {1101.686768,     0.032589,   701.005127,    0.0,   -90.0,    0.0} 
        }; 
    //                       race name    coordinates   #laps         checkpoint object     startline object        finishline object 
    raceID = races.addRace(&quot;oval race&quot;, coords3, races.LAPS_NoLaps, &quot;new-checkpoint&quot;, &quot;new-checkpoint-start&quot;, &quot;new-checkpoint-start&quot;); 
    races.setPenaltyTime(raceID, 10); //  &lt;- this sets the default penalty time (in seconds) for this race when a race_penalty event occurs.
    // race 3 added and working


    // RACE 4
    array&lt;array&lt;double&gt; &gt; coords4 =  
        { 
            {1187.875977,     0.0,       1220.567383,    0.0,    90.0,    0.0}, 
            { 784.379578,     0.0,       1221.171143,    0.0,   -90.0,    0.0} 
        }; 
    //             race name    coordinates   #laps         checkpoint object     startline object        finishline object       race version 
    raceID = races.addRace(&quot;drag race&quot;, coords4, races.LAPS_NoLaps, &quot;new-checkpoint&quot;, &quot;new-checkpoint-start&quot;, &quot;new-checkpoint-start&quot;); 
    races.setPenaltyTime(raceID, 10); //  &lt;- this sets the default penalty time (in seconds) for this race when a race_penalty event occurs.
    // race 4 added and working


    // RACE 5
    double[][] coords5 = 
        {
            //   x        z          y      3d rot    rot     3d rot
            { 807.868, 5.09987,   1114.47,    0.0,   -90.0,    0.0},
            { 724.386, 0.0994606, 1084.16,    0.0,     0.0,    0.0},
            { 718.647, 0.0998037, 1038.22,    0.0,    45.0,    0.0},
            { 696.235, 0.0989883,  992.215,   0.0,   -25.0,    0.0},
            { 754.302, 0.098882,   999.441,   0.0,     0.0,    0.0},
            { 763.464, 0.0987995, 1049.56,    0.0,    45.0,    0.0},
            { 831.675, 5.01375,   1058.26,    0.0,    90.0,    0.0},
            { 919.557, 0.0995347, 1083.47,    0.0,     0.0,    0.0},
            { 884.884, 0.0987005, 1121.12,    0.0,   -90.0,    0.0}
        };
    //                   race name   coordinates   #laps (no checkpoint objects are specified here, so the default RoR ones will be used)
    raceID = races.addRace(&quot;mud race&quot;, coords5, 3);
    // race 5 added and working
}

// The default RoR event callback
void eventCallback(int eventnum, int value)
{
    races.eventCallback(eventnum, value);
}

void on_penaltyEvent(dictionary@ info)
{
    // this method gets called every time a race_penalty event occurs.

    // We can also change the penalty time here:
    info.set(&quot;penaltyTime&quot;, 10);
    // But the penalty time was already set to 10 seconds, because we had set it to 10 in the main() function.
    // So now we&#39;ve set it twice to 10 seconds, which is quite pointless...

    // Just show a message to inform the user about the penalty
    races.message(&quot;PENALTY&quot;, &quot;lightning.png&quot;);
}
</code></pre></div> <p><strong>Notes:</strong></p> <ol> <li>We've only used the 'race_penalty' event here, but you can also use the 'race_abort' event, which will abort the race when the event box is triggered.</li> <li>Another way to add penalty seconds is using the <a href=http://docs.rigsofrods.com/angelscript/classraces_manager.html#917f58383f551128acac292effdb3ce2>races.addPenaltySeconds(int seconds)</a> method.</li> <li>You can also register callback functions for other events: <a href=http://docs.rigsofrods.com/angelscript/classraces_manager.html#917f58383f551128acac292effdb3ce2>http://docs.rigsofrods.com/angelscript/classraces_manager.html#917f58383f551128acac292effdb3ce2</a></li> </ol> <h2 id=more-advanced-functionality>More Advanced Functionality<a class=headerlink href=#more-advanced-functionality title="Permanent link">&para;</a></h2> <h3 id=documentation-and-questions>Documentation and questions<a class=headerlink href=#documentation-and-questions title="Permanent link">&para;</a></h3> <p>See <a href=http://development.rigsofrods.org/angelscript/ >reference manual</a>. Studying the script files of other terrains may also greatly help you.</p> <p>In case of questions/suggestions/complains, get in touch <a href=http://www.rigsofrods.org/forum-19.html>in the forums</a>.</p> <h3 id=example-extending-racesmanager>Example: Extending RacesManager<a class=headerlink href=#example-extending-racesmanager title="Permanent link">&para;</a></h3> <p>Here's an example where we inherit from the racesManager class and add functionality. (In this case, we limit the allowed vehicles, so the race won't start if certain vehicles aren't used). You can test this script by adding it to the North Saint Helens terrain.</p> <div class=highlight><pre><span></span><code>#include &quot;base.as&quot;;
#include &quot;races.as&quot;;

racesManagerWithVehicleLimit races();

void main() {

    // Add the race like usual  
    array &lt; array&lt;double&gt;  &gt; coords1 = {  
        {1140.259644, 34.136135, 920.070313, 0.0, 0.0, 0.0},  
        {1140.259644, 34.136135, 950.070313, 0.0, 0.0, 0.0}  
    };  
    int raceID_testRace = races.addRace(&quot;testRace&quot;, coords1, races.LAPS_NoLaps);  

    // Add some vehicles (when you don&#39;t add any vehicles, then all vehicles will be allowed)  
    races.addVehicle(raceID_testRace, &quot;Bus RVI agora S&quot;);  
    races.addVehicle(raceID_testRace, &quot;Bus RVI agora L&quot;);  

}

// Other stuff (No race specific stuff under this line)

class racesManagerWithVehicleLimit : racesManager {

    dictionary vehicleData;  
    double lastMessageTime;  

    racesManagerWithVehicleLimit()  
    {  
        super();  
        lastMessageTime = 0.0;  
    }  

    // extend this method  
    void startRace(int raceID) /*override*/  
    {  
        bool allow = true;  

        // Do we have vehicle data for this race?  
        array &lt;string&gt; @ vehicles = null;  
        if(vehicleData.get(&quot;race_&quot;+raceID, @vehicles))  
        {  
            // Get the name of the current truck  
            string truckName = &quot;avatar&quot;;  
            BeamClass@ truck = game.getCurrentTruck();  
            if(truck !is null)  
                truckName = truck.getTruckName();  

            if(vehicles.find(truckName) &lt;0) 
                allow = false; 
        } 

        if(allow) 
            racesManager::startRace(raceID); 
        else  
        { 
            // Avoid message spam (in exceptional cases) 
            if((game.getTime()-this.lastMessageTime)&gt; 5.0)  
            {  
                this.lastMessageTime = game.getTime();  

                this.message(&quot;Race &quot;+this.raceList[raceID].raceName+&quot; can only be started with one of the following vehicles:&quot;, &quot;information.png&quot;);  
                this.message(arrayToString(vehicles), &quot;information.png&quot;);  
            }  
        }  
    }  

    void addVehicle(int raceID, string vehicleName)  
    {  
        array &lt;string&gt; @ vehicles = null;  
        if(!vehicleData.get(&quot;race_&quot;+raceID, @vehicles))  
        {  
            array &lt;string&gt;  vehicles2 = {};  
            @vehicles = @vehicles2;  
            vehicleData.set(&quot;race_&quot;+raceID, @vehicles);  
        }  

        vehicles.insertLast(vehicleName);  
    }  

}

string arrayToString(array&lt;string&gt;@ arr) {

    string result = &quot;&quot;;  
    if(arr !is null) for(uint i=0; i&lt;arr.length(); ++i)  
    {  
        result += arr[i];  
        if(i!=arr.length()-1) result += &quot;, &quot;;  
    }  
    return result;  

}
</code></pre></div> <h1 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h1> <p>If your race doesn't work, feel free to post your terrain file in this forum, and we may have a look at it. <a href=http://rigsofrods.org/forum-19.html>http://rigsofrods.org/forum-19.html</a></p> <p>Further, you may find some help in this archive: <a href=http://rigsofrods.org/old-forum/forums/167-Scripting/page-0001.html>http://rigsofrods.org/old-forum/forums/167-Scripting/page-0001.html</a></p> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">January 6, 2022</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../race-generator/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Race script generator" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Race script generator </div> </div> </a> <a href=../raw-heightmaps/ class="md-footer__link md-footer__link--next" aria-label="Next: RAW Heightmaps" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> RAW Heightmaps </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2021 Rigs of Rods Community </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["instant", "tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.22074ed6.min.js"}</script> <script src=../../assets/javascripts/bundle.1514a9a0.min.js></script> </body> </html>